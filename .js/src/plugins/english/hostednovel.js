var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}u((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/defaultCover"),n=require("@libs/fetch"),i=require("@libs/filterInputs"),a=require("@libs/novelStatus"),o=require("cheerio"),s=function(){function s(){this.id="net.zegnat.lnreader.hostednovel",this.name="Hosted Novel",this.site="https://hostednovel.com/",this.version="0.1.0",this.icon="siteNotAvailable.png",this.filters={status:{type:i.FilterTypes.CheckboxGroup,label:"Status",value:[a.NovelStatus.Ongoing,a.NovelStatus.Completed],options:[{label:"Ongoing",value:a.NovelStatus.Ongoing},{label:"Completed",value:a.NovelStatus.Completed},{label:"Hiatus",value:a.NovelStatus.OnHiatus},{label:"Dropped",value:a.NovelStatus.Cancelled}]}}}return s.prototype.getPath=function(t){if(t&&t.startsWith(this.site)){var e=t.substring(this.site.length).replace(/(^\/+|\/+$)/g,"");if(0!==e.length)return e}},s.prototype.toStatus=function(t){var e;return null!==(e={Completed:a.NovelStatus.Completed,Ongoing:a.NovelStatus.Ongoing,Hiatus:a.NovelStatus.OnHiatus,Dropped:a.NovelStatus.Cancelled}[t])&&void 0!==e?e:a.NovelStatus.Unknown},s.prototype.grabCachedNovels=function(){return t(this,void 0,void 0,(function(){var t,i,a,s=this;return e(this,(function(e){switch(e.label){case 0:return this.allNovelsCache?[2,this.allNovelsCache]:[4,(0,n.fetchApi)(this.site+"novels").then((function(t){return t.text()}))];case 1:return t=e.sent(),i=(0,o.load)(t),a=i("ul.grid > li.relative").map((function(t,e){var n=i(e),a=s.getPath(n.find("a").first().attr("href"));if(a){var o=n.find("span.flex").first().text(),u=n.find("img").first().attr("data-src"),l=u?new URL(u,s.site).toString():r.defaultCover;return[[s.toStatus(o),n.find("p").first().text(),a,l]]}})).toArray(),this.allNovelsCache=a,[2,a]}}))}))},s.prototype.cacheToItem=function(t){return{name:t[1],path:t[2],cover:t[3]}},s.prototype.popularNovels=function(r,n){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return 1!==r?[2,[]]:[4,this.grabCachedNovels()];case 1:return[2,t.sent().filter((function(t){var e=t[0];return n.filters.status.value.includes(e)})).map(this.cacheToItem)]}}))}))},s.prototype.parseNovel=function(i){return t(this,void 0,void 0,(function(){var t,a,s,u,l,c,h,f,p,v,d,b,g=this;return e(this,(function(e){switch(e.label){case 0:return[4,(0,n.fetchApi)(this.site+i).then((function(t){return t.text()}))];case 1:t=e.sent(),a=(0,o.load)(t),s=a("section img.object-cover").first().attr("src"),u=s?new URL(s,this.site).toString():r.defaultCover,l=[],c=null===(b=a('[aria-label="Pagination"]').first().find('a[href$="#chapters"]').last().attr("href"))||void 0===b?void 0:b.match(/\?page=(\d+)/),h=Array.isArray(c)&&parseInt(c[1])||1,f=1,p=a,e.label=2;case 2:return void 0===p?[3,6]:(v=p("#chapters .flow-root a.flex").map((function(t,e){var r=g.getPath(p(e).attr("href"));if(r)return{name:p(e).find("div > span").first()[0].next.data.trim(),path:r}})).toArray(),l.push.apply(l,v),++f<=h?[4,(0,n.fetchApi)(this.site+i+"?page="+f).then((function(t){return t.text()}))]:[3,4]);case 3:return d=e.sent(),p=(0,o.load)(d),[3,5];case 4:p=void 0,e.label=5;case 5:return[3,2];case 6:return[2,{name:a("h1").first().text(),path:i,author:a("dd").first().text(),status:this.toStatus(a(a("dd").get(2)).text().trim()),genres:a(a("dd").get(4)).find("span").map((function(t,e){return a(e).text()})).toArray().join(","),cover:u,summary:a(".prose").first().text().trim(),chapters:l}]}}))}))},s.prototype.parseChapter=function(r){return t(this,void 0,void 0,(function(){var t,i,a,s,u;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site).concat(r),[4,(0,n.fetchApi)(t).then((function(t){return t.text()}))];case 1:return i=e.sent(),a=(0,o.load)(i),s="<h1>".concat(a("#chapter-title").first().text().trim(),"</h1>"),u=a("#chapter-content").html(),[2,"".concat(s).concat(u)]}}))}))},s.prototype.searchNovels=function(r,n){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return 1!==n?[2,[]]:[4,this.grabCachedNovels()];case 1:return[2,t.sent().filter((function(t){return t[1].toLocaleLowerCase().includes(r.toLocaleLowerCase())})).map(this.cacheToItem)]}}))}))},s}();exports.default=new s;